var fwpmanip_item_control_modal,fwpmanip_item_control_modal_handler;!function(a){var b={};flush_current=!1,fwpmanip_item_control_modal=function(c){var d,e,f=a("#"+c.modal+"-tmpl"),g=Handlebars.compile(f.html()),h={};return b[c.modal]&&flush_current===!1?(h={config:b[c.modal].data("config")},d="add"):(flush_current=!1,d="update",h=c.trigger.data("default")),e=a(g(h)),e.find("[data-default]").each(function(){var b=a(this);b.val(b.data("default"))}),a("#"+c.modal+'_fwpmanipModal .fwpmanip-modal-footer [data-state="'+d+'"]').remove(),e},fwpmanip_item_control_modal_handler=function(e,f){var g,h=c(f.params.requestData.control,e.data);b[f.params.requestData.control+"-config"]?(g=b[f.params.requestData.control+"-config"],b[f.params.requestData.control+"-config"]=null,g.replaceWith(h)):(g=a("#"+f.params.requestData.control),h.appendTo(g)),d(a("#"+f.params.requestData.control))};var c=function(b,c){var d=a("#"+b+"-tmpl"),e=Handlebars.compile(d.html()),f=a(e(c));return f.data("config",c),a(document).trigger("fwpmanip.init"),f},d=function(b){var c;c=a(b?b:".fwpmanip-control-item");for(var d=0;d<c.length;d++){for(var e=a(c[d]),f=a("#"+e.prop("id")+"-control"),g=e.find(".fwpmanip-item"),h=[],i=0;i<g.length;i++){var j=a(g[i]);h.push(j.data("config"))}f.val(JSON.stringify(h)).trigger("change")}a(document).trigger("fwpmanip.save")};a(document).on("click",".fwpmanip-item-edit",function(){var c=a(this),d=c.closest(".fwpmanip-control-item"),e=d.prop("id")+"-config",f=a('button[data-modal="'+e+'"]');b[e]=c.closest(".fwpmanip-item"),flush_current=!1,f.trigger("click")}),a(document).on("click",".fwpmanip-item-remove",function(){var c=a(this),e=c.closest(".fwpmanip-control-item"),f=e.prop("id")+"-config",g=(a('button[data-modal="'+f+'"]'),c.closest(".fwpmanip-item"));(!c.data("confirm")||confirm(c.data("confirm")))&&(b[f]=null,g.fadeOut(200,function(){g.remove(),d(e)}))}),a(window).on("modals.closed",function(){flush_current=!0}),a(window).load(function(){a(document).on("fwpmanip.init",function(){a(".fwpmanip-control-item").not("._fwpmanip_item_init").each(function(){var b,d=a(this),e=a("#"+d.prop("id")+"-control");if(!d.hasClass("_fwpmanip_item_init")){d.addClass("_fwpmanip_item_init");try{b=JSON.parse(e.val())}catch(f){}if(d.addClass("_fwpmanip_item_init"),"object"==typeof b&&b.length)for(var g=0;g<b.length;g++){var h=c(d.prop("id"),b[g]);h.appendTo(d)}d.removeClass("processing")}})})})}(jQuery);